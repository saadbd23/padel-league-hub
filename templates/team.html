{% extends "base.html" %}
{% block content %}
<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
  <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8 mb-8">
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-3xl font-bold text-gray-900">{{ team.team_name }}</h2>
        <div class="mt-2 text-lg text-gray-700">
          <div>{{ team.player1_name }}</div>
          <div>{{ team.player2_name }}</div>
        </div>
      </div>
      <div class="text-sm text-gray-600">Recent: 
        {% for r in recent_form %}
          <span class="inline-block px-2 py-0.5 rounded-full {% if r=='W' %}bg-green-100 text-green-800{% elif r=='D' %}bg-yellow-100 text-yellow-800{% else %}bg-red-100 text-red-800{% endif %}">{{ r }}</span>
        {% else %}
          <span class="text-gray-400">No results yet</span>
        {% endfor %}
      </div>
    </div>
    <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4">
      <div class="bg-gray-50 rounded-lg p-4 text-center">
        <div class="text-xs text-gray-500">Points</div>
        <div class="text-2xl font-bold">{{ team.points }}</div>
      </div>
      <div class="bg-gray-50 rounded-lg p-4 text-center">
        <div class="text-xs text-gray-500">W-D-L</div>
        <div class="text-2xl font-bold">{{ team.wins }}-{{ team.draws }}-{{ team.losses }}</div>
      </div>
      <div class="bg-gray-50 rounded-lg p-4 text-center">
        <div class="text-xs text-gray-500">Sets</div>
        <div class="text-2xl font-bold">{{ team.sets_for }}-{{ team.sets_against }}</div>
      </div>
      <div class="bg-gray-50 rounded-lg p-4 text-center">
        <div class="text-xs text-gray-500">Games</div>
        <div class="text-2xl font-bold">{{ team.games_for }}-{{ team.games_against }}</div>
      </div>
    </div>
  </div>

  <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8">
    <h3 class="text-2xl font-bold text-gray-900 mb-6">Match History</h3>
    {% if matches %}
    <div class="space-y-3">
      {% for m in matches %}
      {% set is_a = m.team_a_id == team.id %}
      {% set opp_id = m.team_b_id if is_a else m.team_a_id %}
      {% set opp = ({}).update({}) %}
      {% set opponent = (team if false else (teams|selectattr('id','equalto',opp_id)|first)) %}
      <div class="border border-gray-200 rounded-lg p-4">
        <div class="flex flex-wrap items-center justify-between gap-2">
          <div class="text-sm text-gray-500">Round {{ m.round or '-' }}</div>
          <div class="text-xs px-2 py-1 rounded-full {% if m.status=='completed' %}{% if m.winner_id == team.id %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}{% elif m.status=='scheduled' %}bg-yellow-100 text-yellow-800{% else %}bg-gray-100 text-gray-700{% endif %}">
            {% if m.status=='completed' %}
              {% if m.winner_id == team.id %}Win{% else %}Loss{% endif %}
            {% else %}
              {{ m.status|capitalize }}
            {% endif %}
          </div>
        </div>
        <div class="mt-2 flex flex-wrap items-center justify-between">
          <div class="font-semibold">vs {{ opponent.team_name if opponent else 'Unknown' }}</div>
          {% if m.status=='completed' %}
          <div class="text-sm text-gray-800">
            {% if is_a %}
              {{ m.score_a }}
            {% else %}
              {{ m.score_b }}
            {% endif %}
          </div>
          {% elif m.round >= 6 %}
          <div class="text-xs text-gray-500 italic">Knockout Round: Reschedules/Subs disabled</div>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
      <p class="text-gray-600">No matches yet.</p>
    {% endif %}
  </div>
</div>
{% endblock %}

