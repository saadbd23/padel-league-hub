{% extends "base.html" %}

{% block title %}{{ team.team_name }} - My Ladder Team{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-50 via-indigo-50 to-pink-50 py-12">
  <div class="max-w-6xl mx-auto px-4">

    <!-- Payment Pending Notice (if not paid) -->
    {% if not team.payment_received %}
    <div class="bg-red-50 border-4 border-red-500 rounded-2xl shadow-2xl p-8 mb-8">
      <div class="text-center">
        <div class="text-6xl mb-4">‚ö†Ô∏è</div>
        <h2 class="text-3xl font-bold text-red-900 mb-4">PAYMENT PENDING</h2>
        <p class="text-lg text-red-800 mb-6">
          Your team registration is <strong>incomplete</strong>. To access all ladder features and be listed in the rankings, please complete your payment.
        </p>

        <div class="bg-white rounded-xl p-6 max-w-2xl mx-auto border-2 border-red-300">
          <h3 class="text-xl font-bold text-gray-900 mb-4">Payment Instructions</h3>
          <div class="text-left space-y-3 text-gray-800">
            <p><strong>Payment Method:</strong> bKash</p>
            <p><strong>Payment Number:</strong> <span class="text-2xl font-mono bg-yellow-100 px-3 py-1 rounded">01313399918</span></p>
            <p><strong>Amount:</strong> <span class="text-2xl font-bold text-red-600">BDT 500</span></p>
            <p class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
              <strong class="text-yellow-900">‚ö†Ô∏è IMPORTANT:</strong><br>
              <span class="text-yellow-800">When making the payment, you MUST put your team name in the reference/note field:</span><br>
              <span class="text-xl font-bold text-purple-900 mt-2 block">Reference: {{ team.team_name }}</span>
            </p>
            <p class="text-sm text-gray-600 italic">
              Failure to include your team name may cause delays in confirming your payment and listing your team on the ladder.
            </p>
          </div>
        </div>

        <div class="mt-6 text-sm text-red-700">
          Once payment is confirmed by admin, you will have full access to challenge teams and participate in the ladder tournament.
        </div>
      </div>
    </div>
    {% else %}

    <!-- Team Overview Card -->
    <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8 mb-8">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
        <!-- Team Info -->
        <div class="flex-1">
          <div class="flex items-center gap-4 mb-4">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">
              {{ team.team_name }}
            </h1>
            <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold
                         {% if status_color == 'green' %}bg-green-100 text-green-800
                         {% elif status_color == 'orange' %}bg-orange-100 text-orange-800
                         {% elif status_color == 'blue' %}bg-blue-100 text-blue-800
                         {% else %}bg-gray-100 text-gray-800{% endif %}">
              {% if team_status == 'locked' %}üîí
              {% elif team_status == 'holiday' %}üèñÔ∏è
              {% else %}‚úì{% endif %}
              {{ status_message }}
            </span>
          </div>

          <!-- Players -->
          <div class="space-y-2 mb-4">
            <div class="flex items-center text-gray-700">
              <svg class="w-5 h-5 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
              </svg>
              <span class="font-medium">{{ team.player1_name }}</span>
              {% if team.contact_preference_whatsapp %}
                <a href="https://wa.me/{{ team.player1_phone }}" target="_blank" class="ml-2 text-green-600 hover:text-green-700">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                  </svg>
                </a>
              {% endif %}
            </div>
            <div class="flex items-center text-gray-700">
              <svg class="w-5 h-5 mr-2 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"/>
              </svg>
              <span class="font-medium">{{ team.player2_name }}</span>
              {% if team.contact_preference_whatsapp %}
                <a href="https://wa.me/{{ team.player2_phone }}" target="_blank" class="ml-2 text-green-600 hover:text-green-700">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                  </svg>
                </a>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Stats -->
        <div class="flex gap-6">
          <div class="text-center">
            <div class="text-sm text-gray-600 mb-1">Current Rank</div>
            <div class="text-4xl font-bold">
              {% if team.current_rank == 1 %}ü•á
              {% elif team.current_rank == 2 %}ü•à
              {% elif team.current_rank == 3 %}ü•â
              {% else %}<span class="bg-gradient-to-r from-purple-600 to-indigo-600 bg-clip-text text-transparent">#{{ team.current_rank }}</span>{% endif %}
            </div>
          </div>
          <div class="text-center">
            <div class="text-sm text-gray-600 mb-1">Record</div>
            <div class="text-2xl font-bold text-gray-900">
              <span class="text-green-600">{{ team.wins }}</span>-<span class="text-gray-500">{{ team.draws }}</span>-<span class="text-red-600">{{ team.losses }}</span>
            </div>
          </div>
          <div class="text-center">
            <div class="text-sm text-gray-600 mb-1">Sets Diff</div>
            <div class="text-2xl font-bold {% if team.sets_diff > 0 %}text-green-600{% elif team.sets_diff < 0 %}text-red-600{% else %}text-gray-600{% endif %}">
              {% if team.sets_diff > 0 %}+{% endif %}{{ team.sets_diff }}
            </div>
          </div>
          <div class="text-center">
            <div class="text-sm text-gray-600 mb-1">Games Diff</div>
            <div class="text-2xl font-bold {% if team.games_diff > 0 %}text-green-600{% elif team.games_diff < 0 %}text-red-600{% else %}text-gray-600{% endif %}">
              {% if team.games_diff > 0 %}+{% endif %}{{ team.games_diff }}
            </div>
          </div>
        </div>
      </div>

      <!-- Security Notice -->
      <div class="mt-6 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
        <div class="flex items-start">
          <svg class="w-5 h-5 text-blue-600 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
          </svg>
          <div class="text-sm text-blue-800">
            <strong>Private Link:</strong> This is your team's secure dashboard. Bookmark this URL to manage your ladder challenges and matches anytime!
          </div>
        </div>
      </div>
    </div>

    <!-- Holiday Mode Management -->
    <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8 mb-8">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center">
          <svg class="w-6 h-6 text-blue-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 019 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z" clip-rule="evenodd"/>
          </svg>
          <h2 class="text-2xl font-bold text-gray-900">Holiday Mode</h2>
        </div>
        <form method="POST" action="{{ url_for('ladder_my_team', token=team.access_token) }}" class="inline">
          <input type="hidden" name="action" value="toggle_holiday">
          <button type="submit" class="px-6 py-2 rounded-lg font-semibold transition
                                       {% if team.holiday_mode_active %}bg-green-100 text-green-700 hover:bg-green-200
                                       {% else %}bg-blue-100 text-blue-700 hover:bg-blue-200{% endif %}">
            {% if team.holiday_mode_active %}Deactivate{% else %}Activate{% endif %} Holiday Mode
          </button>
        </form>
      </div>

      {% if team.holiday_mode_active and holiday_info %}
      <!-- Holiday Mode Active -->
      <div class="space-y-4">
        <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <div class="text-sm text-gray-600">Start Date</div>
              <div class="text-lg font-semibold text-gray-900">{{ holiday_info.start_date.strftime('%b %d, %Y') }}</div>
            </div>
            <div>
              <div class="text-sm text-gray-600">Days in Holiday</div>
              <div class="text-lg font-semibold text-gray-900">{{ holiday_info.days_in_holiday }} days</div>
            </div>
            <div>
              <div class="text-sm text-gray-600">Grace Period Remaining</div>
              <div class="text-lg font-semibold {% if holiday_info.is_in_grace_period %}text-green-600{% else %}text-red-600{% endif %}">
                {% if holiday_info.is_in_grace_period %}
                  {{ holiday_info.grace_period_days_remaining }} days
                {% else %}
                  Expired {{ holiday_info.weeks_beyond_grace }} week(s) ago
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        {% if not holiday_info.is_in_grace_period %}
        <div class="p-4 bg-red-50 rounded-lg border-l-4 border-red-400">
          <div class="flex items-start">
            <svg class="w-5 h-5 text-red-600 mt-0.5 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
            </svg>
            <div class="text-sm text-red-800">
              <strong>Warning:</strong> You've exceeded the {{ settings.holiday_mode_grace_weeks }}-week grace period!
              You're currently being penalized <strong>{{ holiday_info.penalty_ranks }} rank(s)</strong>.
              Deactivate holiday mode to stop accumulating penalties.
            </div>
          </div>
        </div>
        {% endif %}
      </div>
      {% else %}
      <!-- Holiday Mode Explanation -->
      <div class="text-gray-700 space-y-2">
        <p>üèñÔ∏è <strong>Holiday Mode</strong> lets you take a break from the ladder without losing your position permanently.</p>
        <p>‚Ä¢ <strong>{{ settings.holiday_mode_grace_weeks }}-week grace period:</strong> No rank penalties during this time</p>
        <p>‚Ä¢ <strong>After grace period:</strong> Drop {{ settings.holiday_mode_weekly_penalty_ranks }} rank(s) per week</p>
        <p>‚Ä¢ <strong>While on holiday:</strong> You cannot be challenged and cannot challenge others</p>
        <p>‚Ä¢ <strong>Deactivate anytime</strong> to return to active status</p>
      </div>
      {% endif %}
    </div>

    <!-- Active Challenges Section -->
    <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8 mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
        <svg class="w-6 h-6 text-purple-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"/>
        </svg>
        Active Challenges
      </h2>

      {% if challenges_sent or challenges_received %}
      <div class="space-y-6">
        <!-- Challenges You've Sent -->
        {% if challenges_sent %}
        <div>
          <h3 class="text-lg font-semibold text-gray-800 mb-3">Challenges Sent</h3>
          <div class="space-y-3">
            {% for detail in challenges_sent %}
            {% set c = detail.challenge %}
            {% set opp = detail.opponent %}
            <div class="border-2 border-purple-200 rounded-lg p-4 bg-purple-50">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div class="flex-1">
                  <div class="font-bold text-gray-900 text-lg">vs {{ opp.team_name }}</div>
                  <div class="text-sm text-gray-600">{{ opp.player1_name }} & {{ opp.player2_name }}</div>
                  <div class="text-xs text-gray-500 mt-1">Rank #{{ opp.current_rank }}</div>
                </div>
                <div class="text-center">
                  <div class="text-sm text-gray-600">Status</div>
                  <div class="font-semibold {% if c.status == 'accepted' %}text-green-600{% else %}text-yellow-600{% endif %}">
                    {{ c.status.replace('_', ' ').title() }}
                  </div>
                  {% if c.status == 'pending_acceptance' %}
                  <div class="text-xs text-gray-500 mt-1">
                    Deadline: {{ c.acceptance_deadline.strftime('%b %d, %I:%M %p') }}
                  </div>
                  {% elif c.status == 'accepted' and c.completion_deadline %}
                  <div class="text-xs text-gray-500 mt-1">
                    Complete by: {{ c.completion_deadline.strftime('%b %d, %Y') }}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Challenges You've Received -->
        {% if challenges_received %}
        <div>
          <h3 class="text-lg font-semibold text-gray-800 mb-3">Challenges Received</h3>
          <div class="space-y-3">
            {% for detail in challenges_received %}
            {% set c = detail.challenge %}
            {% set opp = detail.opponent %}
            <div class="border-2 {% if detail.is_deadline_approaching %}border-red-400 bg-red-50{% elif detail.is_past_deadline %}border-gray-400 bg-gray-100{% else %}border-indigo-200 bg-indigo-50{% endif %} rounded-lg p-4">

              {% if detail.is_deadline_approaching %}
              <div class="mb-3 p-3 bg-red-100 border-l-4 border-red-500 rounded">
                <div class="flex items-center">
                  <svg class="w-5 h-5 text-red-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                  </svg>
                  <div>
                    <div class="font-bold text-red-900">‚ö†Ô∏è URGENT - Deadline Approaching!</div>
                    <div class="text-sm text-red-800">You have less than {{ "%.1f"|format(detail.hours_until_deadline) }} hours to respond or face a penalty!</div>
                  </div>
                </div>
              </div>
              {% endif %}

              {% if detail.is_past_deadline %}
              <div class="mb-3 p-3 bg-gray-200 border-l-4 border-gray-500 rounded">
                <div class="flex items-center">
                  <svg class="w-5 h-5 text-gray-700 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                  </svg>
                  <div class="font-bold text-gray-900">Deadline Passed - Penalty will be applied</div>
                </div>
              </div>
              {% endif %}

              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div class="flex-1">
                  <div class="font-bold text-gray-900 text-lg">Challenge from {{ opp.team_name }}</div>
                  <div class="text-sm text-gray-600">{{ opp.player1_name }} & {{ opp.player2_name }}</div>
                  <div class="text-xs text-gray-500 mt-1">Rank #{{ opp.current_rank }}</div>
                </div>
                <div>
                  {% if c.status == 'pending_acceptance' %}
                  <div class="flex gap-2">
                    <form method="POST" action="{{ url_for('ladder_my_team', token=team.access_token) }}" class="inline">
                      <input type="hidden" name="action" value="accept_challenge">
                      <input type="hidden" name="challenge_id" value="{{ c.id }}">
                      <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition">
                        Accept
                      </button>
                    </form>
                    <form method="POST" action="{{ url_for('ladder_my_team', token=team.access_token) }}" class="inline">
                      <input type="hidden" name="action" value="reject_challenge">
                      <input type="hidden" name="challenge_id" value="{{ c.id }}">
                      <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition">
                        Reject
                      </button>
                    </form>
                  </div>
                  <div class="text-xs {% if detail.is_deadline_approaching %}text-red-700 font-bold{% else %}text-gray-500{% endif %} mt-2 text-center">
                    Deadline: {{ c.acceptance_deadline.strftime('%b %d, %I:%M %p') }}
                  </div>
                  {% else %}
                  <div class="text-center">
                    <div class="text-sm text-gray-600">Status</div>
                    <div class="font-semibold text-green-600">Accepted</div>
                    {% if c.completion_deadline %}
                    <div class="text-xs text-gray-500 mt-1">
                      Complete by: {{ c.completion_deadline.strftime('%b %d, %Y') }}
                    </div>
                    {% endif %}
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
      {% else %}
      <div class="text-center py-8">
        <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
        </svg>
        <p class="text-gray-600 text-lg">No active challenges</p>
        <p class="text-gray-500 text-sm mt-2">Visit the ladder rankings to challenge other teams!</p>
      </div>
      {% endif %}
    </div>

    <!-- Pending Matches Section -->
    {% if pending_matches %}
    <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8 mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
        <svg class="w-6 h-6 text-yellow-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
        </svg>
        Pending Matches
      </h2>

      <div class="space-y-4">
        {% for detail in pending_matches %}
        {% set m = detail.match %}
        {% set opp = detail.opponent %}
        <div class="border-2 border-yellow-200 rounded-lg p-6 bg-yellow-50">
          <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-4">
            <div class="flex-1">
              <div class="font-bold text-gray-900 text-lg mb-2">vs {{ opp.team_name }}</div>
              <div class="text-sm text-gray-600">{{ opp.player1_name }} & {{ opp.player2_name }}</div>

              <!-- Contact Info -->
              <div class="mt-3 space-y-1">
                {% if opp.contact_preference_whatsapp %}
                <div class="text-xs text-gray-600">
                  <a href="https://wa.me/{{ opp.player1_phone }}" target="_blank" class="text-green-600 hover:text-green-700">
                    üì± {{ opp.player1_name }}: WhatsApp
                  </a>
                </div>
                <div class="text-xs text-gray-600">
                  <a href="https://wa.me/{{ opp.player2_phone }}" target="_blank" class="text-green-600 hover:text-green-700">
                    üì± {{ opp.player2_name }}: WhatsApp
                  </a>
                </div>
                {% endif %}
                {% if opp.contact_preference_email %}
                <div class="text-xs text-gray-600">
                  üìß Contact via email
                </div>
                {% endif %}
              </div>
            </div>

            <!-- Score Submission Status -->
            <div class="text-sm">
              {% if detail.team_submitted and detail.opponent_submitted %}
                {% if m.disputed %}
                <div class="p-3 bg-red-100 rounded border border-red-300">
                  <div class="font-semibold text-red-800">‚ö†Ô∏è Scores Disputed</div>
                  <div class="text-xs text-red-700 mt-1">Admin review required</div>
                </div>
                {% else %}
                <div class="p-3 bg-blue-100 rounded border border-blue-300">
                  <div class="font-semibold text-blue-800">‚è≥ Awaiting Verification</div>
                  <div class="text-xs text-blue-700 mt-1">Both teams submitted</div>
                </div>
                {% endif %}
              {% elif detail.team_submitted %}
              <div class="p-3 bg-green-100 rounded border border-green-300">
                <div class="font-semibold text-green-800">‚úì You Submitted</div>
                <div class="text-xs text-green-700 mt-1">Waiting for opponent</div>
              </div>
              {% elif detail.opponent_submitted %}
              <div class="p-3 bg-orange-100 rounded border border-orange-300">
                <div class="font-semibold text-orange-800">‚è≥ Opponent Submitted</div>
                <div class="text-xs text-orange-700 mt-1">Please submit your score</div>
              </div>
              {% else %}
              <div class="p-3 bg-yellow-100 rounded border border-yellow-300">
                <div class="font-semibold text-yellow-800">üìù Awaiting Scores</div>
                <div class="text-xs text-yellow-700 mt-1">No submissions yet</div>
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Score Submission Form -->
          {% if not detail.team_submitted %}
          <div class="mt-4 p-4 bg-white rounded-lg border-2 border-purple-200">
            <h4 class="font-semibold text-gray-900 mb-3">Submit Match Score</h4>
            <p class="text-xs text-gray-600 mb-4">Enter the score from your team's perspective. Typical padel scores: 6-0, 6-1, 6-2, 6-3, 6-4, 7-5, 7-6</p>

            <form method="POST" action="{{ url_for('ladder_my_team', token=team.access_token) }}" id="scoreForm">
              <input type="hidden" name="action" value="submit_score">
              <input type="hidden" name="match_id" value="{{ m.id }}">

              <!-- Set 1 -->
              <div class="mb-4">
                <label class="block text-sm font-semibold text-gray-800 mb-2">Set 1 (Required)</label>
                <div class="grid grid-cols-2 gap-3">
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">Your Team</label>
                    <input type="number" name="set1_team_score" min="0" max="7" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" 
                           placeholder="6" required>
                  </div>
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">Opponent</label>
                    <input type="number" name="set1_opponent_score" min="0" max="7" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" 
                           placeholder="4" required>
                  </div>
                </div>
              </div>

              <!-- Set 2 -->
              <div class="mb-4">
                <label class="block text-sm font-semibold text-gray-800 mb-2">Set 2 (Required)</label>
                <div class="grid grid-cols-2 gap-3">
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">Your Team</label>
                    <input type="number" name="set2_team_score" min="0" max="7" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" 
                           placeholder="6" required>
                  </div>
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">Opponent</label>
                    <input type="number" name="set2_opponent_score" min="0" max="7" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" 
                           placeholder="3" required>
                  </div>
                </div>
              </div>

              <!-- Set 3 (Optional) -->
              <div class="mb-4">
                <label class="block text-sm font-semibold text-gray-800 mb-2">Set 3 (Optional - only if played)</label>
                <div class="grid grid-cols-2 gap-3">
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">Your Team</label>
                    <input type="number" name="set3_team_score" min="0" max="7" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" 
                           placeholder="Leave empty if not played">
                  </div>
                  <div>
                    <label class="block text-xs text-gray-600 mb-1">Opponent</label>
                    <input type="number" name="set3_opponent_score" min="0" max="7" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" 
                           placeholder="Leave empty if not played">
                  </div>
                </div>
              </div>

              <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="flex items-start">
                  <svg class="w-5 h-5 text-yellow-600 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                  </svg>
                  <div class="text-xs text-yellow-800">
                    <strong>Important:</strong> Both teams must submit scores. Your submission will be verified against your opponent's. Make sure the scores are accurate!
                  </div>
                </div>
              </div>

              <button type="submit" class="w-full mt-4 px-4 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition shadow-lg">
                Submit Score
              </button>
            </form>
          </div>
          {% endif %}

          <!-- No-Show Reporting Section -->
          {% if m.reported_no_show_team_id %}
          <!-- No-Show Report Already Filed -->
          <div class="mt-4 p-4 rounded-lg border-2 {% if m.no_show_verified %}bg-red-50 border-red-300{% else %}bg-orange-50 border-orange-300{% endif %}">
            <h4 class="font-semibold {% if m.no_show_verified %}text-red-900{% else %}text-orange-900{% endif %} mb-3 flex items-center">
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
              {% if m.no_show_verified %}
              No-Show Verified by Admin
              {% else %}
              No-Show Report Under Review
              {% endif %}
            </h4>
            <div class="text-sm {% if m.no_show_verified %}text-red-800{% else %}text-orange-800{% endif %} space-y-2">
              {% if m.reported_by_team_id == team.id %}
              <p><strong>You reported:</strong> {{ opp.team_name }} as no-show</p>
              {% else %}
              <p><strong>{{ opp.team_name }} reported:</strong> Your team as no-show</p>
              {% endif %}
              <p><strong>Report Date:</strong> {{ m.no_show_report_date.strftime('%B %d, %Y at %I:%M %p') if m.no_show_report_date else 'N/A' }}</p>
              {% if m.no_show_verified %}
              <p><strong>Status:</strong> ‚úì Verified - Match resolved</p>
              {% if m.no_show_notes %}
              <p><strong>Admin Notes:</strong> {{ m.no_show_notes }}</p>
              {% endif %}
              {% else %}
              <p><strong>Status:</strong> ‚è≥ Awaiting admin review</p>
              <p class="mt-2 text-xs">An administrator will review the evidence and make a decision. Both teams will be notified once the review is complete.</p>
              {% endif %}
            </div>
          </div>
          {% elif not detail.team_submitted and not detail.opponent_submitted and detail.challenge %}
          <!-- Report No-Show Button (only if deadline passed and no scores submitted) -->
          {% if detail.is_past_deadline %}
          <div class="mt-4 p-4 bg-red-50 rounded-lg border-2 border-red-300">
            <h4 class="font-semibold text-red-900 mb-3 flex items-center">
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
              Match Deadline Passed
            </h4>
            <p class="text-sm text-red-800 mb-4">
              The deadline for this match has passed. If your opponent did not show up or failed to coordinate a match time, you can report them for no-show.
            </p>
            <form method="POST" action="{{ url_for('ladder_my_team', token=team.access_token) }}" onsubmit="return confirm('Are you sure you want to report {{ opp.team_name }} for no-show? This will be reviewed by an administrator.');">
              <input type="hidden" name="action" value="report_no_show">
              <input type="hidden" name="match_id" value="{{ m.id }}">
              <button type="submit" class="w-full px-4 py-3 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 transition shadow-lg flex items-center justify-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                Report {{ opp.team_name }} for No-Show
              </button>
            </form>
            <div class="mt-3 p-3 bg-white border border-red-200 rounded">
              <p class="text-xs text-gray-700">
                <strong>Note:</strong> No-show reports are reviewed by administrators to prevent abuse. False reports may result in penalties. Only report if your opponent genuinely failed to show up or coordinate the match.
              </p>
            </div>
          </div>
          {% elif detail.challenge.completion_deadline %}
          <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
            <p class="text-sm text-blue-800">
              <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
              </svg>
              <strong>Match Deadline:</strong> {{ detail.challenge.completion_deadline.strftime('%B %d, %Y at %I:%M %p') }}
            </p>
            <p class="text-xs text-blue-700 mt-2">
              If your opponent doesn't show up by the deadline, you can report them for no-show and an admin will review.
            </p>
          </div>
          {% endif %}
          {% endif %}

          <!-- Show Disputed Scores -->
          {% if m.disputed %}
          <div class="mt-4 p-4 bg-red-50 rounded-lg border-2 border-red-300">
            <h4 class="font-semibold text-red-900 mb-3 flex items-center">
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
              Score Dispute
            </h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
              <div class="bg-white p-3 rounded border border-red-200">
                <div class="font-semibold text-gray-900 mb-2">Your Submission:</div>
                {% if detail.is_team_a %}
                <div class="text-gray-700">
                  Set 1: {{ m.team_a_score_set1 }}-{{ m.team_b_score_set1 }}<br>
                  Set 2: {{ m.team_a_score_set2 }}-{{ m.team_b_score_set2 }}
                  {% if m.team_a_score_set3 %}<br>Set 3: {{ m.team_a_score_set3 }}-{{ m.team_b_score_set3 }}{% endif %}
                </div>
                {% else %}
                <div class="text-gray-700">
                  Set 1: {{ m.team_b_score_set1 }}-{{ m.team_a_score_set1 }}<br>
                  Set 2: {{ m.team_b_score_set2 }}-{{ m.team_a_score_set2 }}
                  {% if m.team_b_score_set3 %}<br>Set 3: {{ m.team_b_score_set3 }}-{{ m.team_a_score_set3 }}{% endif %}
                </div>
                {% endif %}
              </div>
              <div class="bg-white p-3 rounded border border-red-200">
                <div class="font-semibold text-gray-900 mb-2">{{ opp.team_name }}'s Submission:</div>
                {% if detail.is_team_a %}
                <div class="text-gray-700">
                  Set 1: {{ m.team_b_score_set1 }}-{{ m.team_a_score_set1 }}<br>
                  Set 2: {{ m.team_b_score_set2 }}-{{ m.team_a_score_set2 }}
                  {% if m.team_b_score_set3 %}<br>Set 3: {{ m.team_b_score_set3 }}-{{ m.team_a_score_set3 }}{% endif %}
                </div>
                {% else %}
                <div class="text-gray-700">
                  Set 1: {{ m.team_a_score_set1 }}-{{ m.team_b_score_set1 }}<br>
                  Set 2: {{ m.team_a_score_set2 }}-{{ m.team_b_score_set2 }}
                  {% if m.team_a_score_set3 %}<br>Set 3: {{ m.team_a_score_set3 }}-{{ m.team_b_score_set3 }}{% endif %}
                </div>
                {% endif %}
              </div>
            </div>
            <p class="text-sm text-red-800 mt-3">An administrator will review and resolve this dispute.</p>
          </div>
          {% endif %}
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Match History -->
    {% if completed_matches %}
    <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8 mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
        <svg class="w-6 h-6 text-green-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
        </svg>
        Match History
      </h2>

      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wider">Opponent</th>
              <th class="px-4 py-3 text-center text-xs font-semibold uppercase tracking-wider">Date</th>
              <th class="px-4 py-3 text-center text-xs font-semibold uppercase tracking-wider">Score</th>
              <th class="px-4 py-3 text-center text-xs font-semibold uppercase tracking-wider">Result</th>
              <th class="px-4 py-3 text-center text-xs font-semibold uppercase tracking-wider">Rank Change</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200">
            {% for detail in completed_matches %}
            {% set m = detail.match %}
            {% set opp = detail.opponent %}
            <tr class="hover:bg-purple-50 transition-colors">
              <td class="px-4 py-3">
                <div class="font-semibold text-gray-900">{{ opp.team_name }}</div>
                <div class="text-xs text-gray-600">{{ opp.player1_name }} & {{ opp.player2_name }}</div>
              </td>
              <td class="px-4 py-3 text-center text-sm text-gray-600">
                {% if m.completed_at %}
                  {{ m.completed_at.strftime('%b %d, %Y') }}
                {% else %}
                  -
                {% endif %}
              </td>
              <td class="px-4 py-3 text-center">
                <div class="text-sm font-semibold text-gray-900">
                  {{ detail.team_score }}
                </div>
                <div class="text-xs text-gray-500">vs</div>
                <div class="text-sm font-semibold text-gray-900">
                  {{ detail.opponent_score }}
                </div>
              </td>
              <td class="px-4 py-3 text-center">
                {% if m.winner_id == team.id %}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800">
                  ‚úì WIN
                </span>
                {% elif m.winner_id == opp.id %}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800">
                  LOSS
                </span>
                {% else %}
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-800">
                  DRAW
                </span>
                {% endif %}
              </td>
              <td class="px-4 py-3 text-center">
                {% if m.winner_id == team.id and m.winner_old_rank and m.winner_new_rank %}
                  {% if m.winner_new_rank < m.winner_old_rank %}
                    <div class="flex flex-col items-center">
                      <span class="text-2xl">‚¨ÜÔ∏è</span>
                      <span class="text-xs font-semibold text-green-700">
                        #{{ m.winner_old_rank }} ‚Üí #{{ m.winner_new_rank }}
                      </span>
                    </div>
                  {% elif m.winner_new_rank > m.winner_old_rank %}
                    <div class="flex flex-col items-center">
                      <span class="text-2xl">‚¨áÔ∏è</span>
                      <span class="text-xs font-semibold text-gray-600">
                        #{{ m.winner_old_rank }} ‚Üí #{{ m.winner_new_rank }}
                      </span>
                    </div>
                  {% else %}
                    <span class="text-xs text-gray-500">
                      Stayed #{{ m.winner_old_rank }}
                    </span>
                  {% endif %}
                {% elif m.winner_id == opp.id and m.loser_old_rank and m.loser_new_rank %}
                  {% if m.loser_new_rank > m.loser_old_rank %}
                    <div class="flex flex-col items-center">
                      <span class="text-2xl">‚¨áÔ∏è</span>
                      <span class="text-xs font-semibold text-red-700">
                        #{{ m.loser_old_rank }} ‚Üí #{{ m.loser_new_rank }}
                      </span>
                    </div>
                  {% else %}
                    <span class="text-xs text-gray-500">
                      Stayed #{{ m.loser_old_rank }}
                    </span>
                  {% endif %}
                {% else %}
                  <span class="text-xs text-gray-400">-</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    {% endif %}

    <!-- Challenge Teams Section -->
    {% if challengeable_teams %}
    <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8 mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
        <svg class="w-6 h-6 text-purple-600 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"/>
        </svg>
        Challenge Teams (Up to {{ settings.max_challenge_rank_difference if settings else 3 }} Ranks Above)
      </h2>

      <div class="space-y-4">
        {% for challengeable in challengeable_teams %}
        <div class="border-2 border-purple-200 rounded-lg p-6 bg-purple-50 hover:bg-purple-100 transition">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-3 mb-2">
                <div class="text-2xl font-bold text-purple-600">#{{ challengeable.current_rank }}</div>
                <div>
                  <h3 class="text-lg md:text-xl font-bold text-gray-900 truncate">{{ challengeable.team_name }}</h3>
                  <div class="text-xs md:text-sm text-gray-600 truncate">
                    {{ challengeable.player1_name }} & {{ challengeable.player2_name }}
                  </div>
                </div>
              </div>

              <!-- Challenge Button (Mobile - Top Right) -->
              <div class="md:hidden flex-shrink-0">
                <form method="POST" action="{{ url_for('ladder_challenge_create') }}">
                  <input type="hidden" name="challenged_team_id" value="{{ challengeable.id }}">
                  <button type="submit" class="px-4 py-2 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white rounded-lg font-semibold transition shadow-lg text-sm">
                    Challenge
                  </button>
                </form>
              </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-3 gap-2 md:gap-3 text-center w-full md:w-auto md:flex-shrink-0">
              <div class="bg-white rounded-lg p-2 md:p-3">
                <div class="text-xs text-gray-500">Record</div>
                <div class="text-xs md:text-sm font-semibold text-gray-900">{{ challengeable.wins }}-{{ challengeable.losses }}-{{ challengeable.draws }}</div>
              </div>
              <div class="bg-white rounded-lg p-2 md:p-3">
                <div class="text-xs text-gray-500">Sets Diff</div>
                <div class="text-xs md:text-sm font-semibold {% if challengeable.sets_diff > 0 %}text-green-600{% elif challengeable.sets_diff < 0 %}text-red-600{% else %}text-gray-600{% endif %}">
                  {% if challengeable.sets_diff > 0 %}+{% endif %}{{ challengeable.sets_diff }}
                </div>
              </div>
              <div class="bg-white rounded-lg p-2 md:p-3">
                <div class="text-xs text-gray-500">Games Diff</div>
                <div class="text-xs md:text-sm font-semibold {% if challengeable.games_diff > 0 %}text-green-600{% elif challengeable.games_diff < 0 %}text-red-600{% else %}text-gray-600{% endif %}">
                  {% if challengeable.games_diff > 0 %}+{% endif %}{{ challengeable.games_diff }}
                </div>
              </div>
            </div>

            <!-- Contact Details -->
            <div class="p-3 md:p-4 bg-white rounded-lg border border-purple-200 w-full md:w-auto md:flex-shrink-0">
              <div class="font-semibold text-gray-700 text-xs md:text-sm mb-2">Contact Details:</div>
              <div class="space-y-1 text-xs text-gray-600">
                {% if challengeable.contact_preference_email and challengeable.player1_email %}
                <div class="break-all">üìß {{ challengeable.player1_name }}: <a href="mailto:{{ challengeable.player1_email }}" class="text-purple-600 hover:text-purple-800 font-semibold">{{ challengeable.player1_email }}</a></div>
                {% endif %}
                {% if challengeable.contact_preference_whatsapp and challengeable.player1_phone %}
                <div>üì± {{ challengeable.player1_name }}: <a href="https://wa.me/+{{ challengeable.player1_phone }}" target="_blank" class="text-green-600 hover:text-green-800 font-semibold">{{ challengeable.player1_phone }}</a></div>
                {% endif %}
                {% if challengeable.contact_preference_email and challengeable.player2_email %}
                <div class="break-all">üìß {{ challengeable.player2_name }}: <a href="mailto:{{ challengeable.player2_email }}" class="text-purple-600 hover:text-purple-800 font-semibold">{{ challengeable.player2_email }}</a></div>
                {% endif %}
                {% if challengeable.contact_preference_whatsapp and challengeable.player2_phone %}
                <div>üì± {{ challengeable.player2_name }}: <a href="https://wa.me/+{{ challengeable.player2_phone }}" target="_blank" class="text-green-600 hover:text-green-800 font-semibold">{{ challengeable.player2_phone }}</a></div>
                {% endif %}
              </div>
            </div>

            <!-- Challenge Button (Desktop - Full Width) -->
            <div class="hidden md:block flex-shrink-0 w-full md:w-48">
              <form method="POST" action="{{ url_for('ladder_challenge_create') }}">
                <input type="hidden" name="challenged_team_id" value="{{ challengeable.id }}">
                <button type="submit" class="w-full px-6 py-4 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white rounded-lg font-semibold transition shadow-lg flex items-center justify-center gap-2">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"/>
                  </svg>
                  Challenge This Team
                </button>
              </form>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% elif not is_locked and not team.holiday_mode_active and team.current_rank > 1 %}
    <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8 mb-8">
      <div class="text-center py-8">
        <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        <p class="text-gray-600 text-lg">No teams available to challenge right now</p>
        <p class="text-gray-500 text-sm mt-2">All teams within {{ settings.max_challenge_rank_difference if settings else 3 }} ranks above you are currently locked or on holiday</p>
      </div>
    </div>
    {% endif %}

    <!-- Quick Actions -->
    <div class="bg-gradient-to-r from-purple-600 to-indigo-700 rounded-2xl shadow-2xl p-8">
      <h2 class="text-2xl font-bold text-white mb-6">Quick Actions</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <a href="{{ url_for('ladder_men' if team.ladder_type == 'men' else 'ladder_women') }}" 
           class="flex items-center justify-center gap-2 px-6 py-4 bg-white/20 hover:bg-white/30 text-white rounded-lg font-semibold transition">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
          </svg>
          View Ladder Rankings
        </a>
      </div>
    </div>

  </div>
</div>
{% endif %}
<!-- End payment check -->

{% endblock %}