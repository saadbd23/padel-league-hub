{% extends "base.html" %}
{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <div class="flex items-center justify-between mb-12">
    <h2 class="text-4xl font-bold text-white text-center flex-1">ğŸ† Playoff Approval</h2>
    <a href="{{ url_for('admin_panel') }}" 
       class="bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold shadow-lg hover:bg-gray-700 transition-all duration-200 flex items-center">
      <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      Back to Admin
    </a>
  </div>

  <!-- Qualified Teams Section -->
  <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8 mb-8">
    <h3 class="text-2xl font-bold text-gray-900 mb-6">âœ… Qualified Teams</h3>
    <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-500 rounded-lg p-4 mb-6">
      <p class="text-green-900 font-semibold">
        ğŸ‰ Swiss rounds complete! {{ qualified_teams|length }} teams have qualified for the playoffs based on their performance.
      </p>
      <p class="text-green-700 text-sm mt-1">
        Please review the seeding and bracket below. Click "Approve Playoffs" to finalize and generate playoff matches.
      </p>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gradient-to-r from-purple-600 to-indigo-700 text-white">
          <tr>
            <th class="px-6 py-4 text-center text-sm font-semibold uppercase tracking-wider">Seed</th>
            <th class="px-6 py-4 text-left text-sm font-semibold uppercase tracking-wider">Team Name</th>
            <th class="px-6 py-4 text-center text-sm font-semibold uppercase tracking-wider">Points</th>
            <th class="px-6 py-4 text-center text-sm font-semibold uppercase tracking-wider">Sets Diff</th>
            <th class="px-6 py-4 text-center text-sm font-semibold uppercase tracking-wider">Games Diff</th>
            <th class="px-6 py-4 text-left text-sm font-semibold uppercase tracking-wider">Record</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          {% for team_data in qualified_teams %}
          <tr class="hover:bg-purple-50/50 transition-colors duration-150 {% if loop.index <= 3 %}bg-gradient-to-r {% if loop.index == 1 %}from-yellow-50 to-amber-50{% elif loop.index == 2 %}from-gray-100 to-slate-100{% elif loop.index == 3 %}from-orange-50 to-amber-50{% endif %}{% endif %}">
            <td class="px-6 py-4 text-center">
              <div class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-gradient-to-r from-purple-600 to-indigo-700 text-white font-bold text-lg">
                {{ team_data.seed }}
              </div>
            </td>
            <td class="px-6 py-4">
              <div class="font-bold text-gray-900">{{ team_data.team.team_name }}</div>
              <div class="text-sm text-gray-600">
                {{ team_data.team.player1_name }} & {{ team_data.team.player2_name }}
              </div>
            </td>
            <td class="px-6 py-4 text-center">
              <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-semibold">
                {{ team_data.points }}
              </span>
            </td>
            <td class="px-6 py-4 text-center">
              <span class="{% if team_data.sets_diff > 0 %}text-green-600{% elif team_data.sets_diff < 0 %}text-red-600{% else %}text-gray-600{% endif %} font-semibold">
                {% if team_data.sets_diff > 0 %}+{% endif %}{{ team_data.sets_diff }}
              </span>
            </td>
            <td class="px-6 py-4 text-center">
              <span class="{% if team_data.games_diff > 0 %}text-green-600{% elif team_data.games_diff < 0 %}text-red-600{% else %}text-gray-600{% endif %} font-semibold">
                {% if team_data.games_diff > 0 %}+{% endif %}{{ team_data.games_diff }}
              </span>
            </td>
            <td class="px-6 py-4">
              <span class="text-sm text-gray-700">
                {{ team_data.team.wins }}W - {{ team_data.team.losses }}L - {{ team_data.team.draws }}D
              </span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Bracket Preview Section -->
  <div class="bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl p-8 mb-8">
    <h3 class="text-2xl font-bold text-gray-900 mb-6">ğŸ“Š Bracket Preview</h3>
    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-l-4 border-blue-500 rounded-lg p-4 mb-6">
      <p class="text-blue-900 font-semibold">
        {% if bracket_preview|length == 4 %}
        ğŸ¯ Quarterfinals Format: Single elimination, best-of-3 sets
        {% else %}
        ğŸ¯ Semifinals Format: Top 4 teams, single elimination, best-of-3 sets
        {% endif %}
      </p>
      <p class="text-blue-700 text-sm mt-1">
        Winners advance to the next round. Semifinal losers will play for 3rd place.
      </p>
    </div>

    <div class="grid md:grid-cols-2 gap-6">
      {% for matchup in bracket_preview %}
      <div class="bg-gradient-to-r from-purple-100 to-indigo-100 rounded-xl p-6 border-2 border-purple-300 shadow-lg">
        <div class="text-center mb-4">
          <span class="bg-purple-600 text-white px-4 py-2 rounded-full text-sm font-bold">
            {{ matchup.match }}
          </span>
        </div>
        <div class="space-y-4">
          <div class="bg-white rounded-lg p-4 flex items-center justify-between shadow-md">
            <div class="flex items-center">
              <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-600 to-indigo-700 text-white font-bold flex items-center justify-center mr-3">
                {{ matchup.seed1 if matchup.seed1 is defined else matchup.seed2 }}
              </div>
              <span class="font-bold text-gray-900">
                {{ matchup.team1 if matchup.team1 is defined else matchup.team2 }}
              </span>
            </div>
            <span class="text-gray-500 text-sm">Higher Seed</span>
          </div>
          <div class="text-center text-gray-500 font-semibold">VS</div>
          <div class="bg-white rounded-lg p-4 flex items-center justify-between shadow-md">
            <div class="flex items-center">
              <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-400 to-indigo-500 text-white font-bold flex items-center justify-center mr-3">
                {{ matchup.seed8 if matchup.seed8 is defined else (matchup.seed7 if matchup.seed7 is defined else (matchup.seed6 if matchup.seed6 is defined else (matchup.seed5 if matchup.seed5 is defined else (matchup.seed4 if matchup.seed4 is defined else matchup.seed3)))) }}
              </div>
              <span class="font-bold text-gray-900">
                {{ matchup.team8 if matchup.team8 is defined else (matchup.team7 if matchup.team7 is defined else (matchup.team6 if matchup.team6 is defined else (matchup.team5 if matchup.team5 is defined else (matchup.team4 if matchup.team4 is defined else matchup.team3)))) }}
              </span>
            </div>
            <span class="text-gray-500 text-sm">Lower Seed</span>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="flex gap-4 justify-center">
    <form method="POST" action="{{ url_for('approve_playoffs') }}">
      <button type="submit" class="bg-gradient-to-r from-green-600 to-emerald-700 text-white px-12 py-4 rounded-lg font-bold text-lg shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 flex items-center">
        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        âœ… Approve Playoffs
      </button>
    </form>
    
    <form method="POST" action="{{ url_for('reject_playoffs') }}" onsubmit="return confirm('Are you sure you want to reject this playoff bracket? This will reset to Swiss phase.');">
      <button type="submit" class="bg-gradient-to-r from-red-600 to-rose-700 text-white px-12 py-4 rounded-lg font-bold text-lg shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 flex items-center">
        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
        âŒ Reject & Regenerate
      </button>
    </form>
  </div>

  <!-- Info Section -->
  <div class="mt-8 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg p-6">
    <div class="flex">
      <div class="flex-shrink-0">
        <svg class="h-6 w-6 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
        </svg>
      </div>
      <div class="ml-3">
        <h3 class="text-sm font-medium text-yellow-800">Important Notes</h3>
        <div class="mt-2 text-sm text-yellow-700">
          <ul class="list-disc list-inside space-y-1">
            <li>Once approved, playoff matches can be generated from the admin panel</li>
            <li>Seeding is based on: Points â†’ Sets Differential â†’ Games Differential â†’ Registration Order</li>
            <li>All playoff matches are best-of-3 sets (same as Swiss rounds)</li>
            <li>If you need to change the seeding, click "Reject & Regenerate"</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
